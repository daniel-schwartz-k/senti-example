<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Sentiment</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
      body * {
        font-family: monospace;
      }
      .ver-container {
        margin: 20px 50px 50px 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }
      .hor-container {
        margin-top: -15px;
        display: flex;
        align-items: center;
        justify-content: space-evenly;
        flex-direction: row;
      }
      .hor-container .item {
        color: dodgerblue;
        font-weight: bold;
        margin: 0 5px;
      }
      .canvas {
        max-height: 500px;
      }
      .title {
        margin: 0;
      }
      h1 {
        font-size: 40px;
        font-weight: 500;
        color: #008000;
      }
      dialog > div > p {
        text-align: left;
      }
      .dialog-title {
        font-size: large;
      }
      .dialog-title:nth-child(n + 2) {
        margin-top: 55px;
      }
      dialog p:nth-child(odd) {
        background-color: azure;
      }
      dialog p:nth-child(even) {
        background-color: beige;
      }

      dialog {
        position: fixed;
        left: 50%;
        right: auto;
        padding: 30px;
        transform: perspective(500px) translate(-50%, -50%);
        background: linear-gradient(to bottom, #fff, #f4f4f4) #fff;
        border: none;
        border-radius: 3px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        text-align: center;
        transform-origin: 50% 50%;
        animation: dialog 300ms cubic-bezier(0.3, 0, 0.1, 1.4) forwards 1;
        will-change: transform, opacity;
        max-height: 310px;
      }
      @keyframes dialog {
        from {
          transform: perspective(500px) translate(-50%, -25%) rotateX(45deg)
            scale(0.1);
          opacity: 0;
        }
      }
      dialog::backdrop {
        opacity: 0;
        will-change: opacity;
        cursor: default;
        background: radial-gradient(
          circle at center,
          rgba(50, 50, 50, 0.5),
          rgba(0, 0, 0, 0.5)
        );
        animation: backdrop 500ms ease forwards 1;
      }
      @keyframes backdrop {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <!-- Should be saturated with data -->
    <script>
      window.Data = { 
      sentiments: [{"rawSentimentSum":1.5,"totalSentiment":0.75,"totalMessageCount":2,"rawMessageCount":2,"_score":1728912420000},{"rawSentimentSum":0.8,"totalSentiment":0.7666666666666666,"totalMessageCount":3,"rawMessageCount":1,"_score":1728912480000},{"rawSentimentSum":0.7,"totalSentiment":0.75,"totalMessageCount":4,"rawMessageCount":1,"_score":1728912540000},{"rawSentimentSum":3.6000000000000005,"totalSentiment":0.6375000000000001,"totalMessageCount":8,"rawMessageCount":6,"_score":1728912600000},{"rawSentimentSum":1.7999999999999998,"totalSentiment":0.5083333333333333,"totalMessageCount":12,"rawMessageCount":5,"_score":1728912660000},{"rawSentimentSum":1.2,"totalSentiment":0.4714285714285714,"totalMessageCount":14,"rawMessageCount":3,"_score":1728912720000},{"rawSentimentSum":0.7,"totalSentiment":0.37000000000000005,"totalMessageCount":10,"rawMessageCount":2,"_score":1728912780000},{"rawSentimentSum":0.7,"totalSentiment":0.4333333333333333,"totalMessageCount":6,"rawMessageCount":1,"_score":1728912840000},{"rawMessageCount":0,"_score":1728912900000},{"rawMessageCount":0,"_score":1728912960000},{"rawSentimentSum":2.1,"totalSentiment":0.525,"totalMessageCount":4,"rawMessageCount":4,"_score":1728913020000},{"rawSentimentSum":0.8,"totalSentiment":0.5800000000000001,"totalMessageCount":5,"rawMessageCount":1,"_score":1728913080000},{"rawSentimentSum":0.8,"totalSentiment":0.6166666666666667,"totalMessageCount":6,"rawMessageCount":1,"_score":1728913140000},{"rawSentimentSum":0.7,"totalSentiment":0.7666666666666666,"totalMessageCount":3,"rawMessageCount":1,"_score":1728913200000},{"rawSentimentSum":0,"totalSentiment":0.5,"totalMessageCount":3,"rawMessageCount":1,"_score":1728913260000},{"rawSentimentSum":1.5,"totalSentiment":0.55,"totalMessageCount":4,"rawMessageCount":2,"_score":1728913320000},{"rawSentimentSum":0,"totalSentiment":0.375,"totalMessageCount":4,"rawMessageCount":1,"_score":1728913380000},{"rawMessageCount":0,"_score":1728913440000},{"rawMessageCount":0,"_score":1728913500000},{"rawMessageCount":0,"_score":1728913560000},{"rawSentimentSum":0.7,"totalSentiment":0.7,"totalMessageCount":1,"rawMessageCount":1,"_score":1728913620000},{"rawMessageCount":0,"_score":1728913680000},{"rawMessageCount":0,"_score":1728913740000},{"rawSentimentSum":0,"totalSentiment":0,"totalMessageCount":1,"rawMessageCount":1,"_score":1728913800000},{"rawMessageCount":0,"_score":1728913860000},{"rawSentimentSum":0,"totalSentiment":0,"totalMessageCount":1,"rawMessageCount":1,"_score":1728913920000},{"rawSentimentSum":0,"totalSentiment":0,"totalMessageCount":2,"rawMessageCount":1,"_score":1728913980000},{"rawSentimentSum":1.6,"totalSentiment":0.4,"totalMessageCount":4,"rawMessageCount":2,"_score":1728914040000},{"rawSentimentSum":1.5,"totalSentiment":0.5,"totalMessageCount":3,"rawMessageCount":3,"_score":1728915000000},{"rawMessageCount":0,"_score":1728915060000},{"rawMessageCount":0,"_score":1728915120000},{"rawMessageCount":0,"_score":1728915180000},{"rawMessageCount":0,"_score":1728915240000},{"rawMessageCount":0,"_score":1728915300000},{"rawMessageCount":0,"_score":1728915360000},{"rawSentimentSum":0.5,"totalSentiment":0.25,"totalMessageCount":2,"rawMessageCount":2,"_score":1728915420000},{"rawSentimentSum":0,"totalSentiment":0.16666666666666666,"totalMessageCount":3,"rawMessageCount":1,"_score":1728915480000},{"rawMessageCount":0,"_score":1728915540000},{"rawMessageCount":0,"_score":1728915600000},{"rawMessageCount":0,"_score":1728915660000},{"rawSentimentSum":0.6,"totalSentiment":0.6,"totalMessageCount":1,"rawMessageCount":1,"_score":1728915720000},{"rawSentimentSum":0,"totalSentiment":0.3,"totalMessageCount":2,"rawMessageCount":1,"_score":1728915780000},{"rawSentimentSum":0.8,"totalSentiment":0.4666666666666667,"totalMessageCount":3,"rawMessageCount":1,"_score":1728915840000},{"rawMessageCount":0,"_score":1728915900000},{"rawMessageCount":0,"_score":1728915960000},{"rawSentimentSum":1.5,"totalSentiment":0.75,"totalMessageCount":2,"rawMessageCount":2,"_score":1728916020000},{"rawMessageCount":0,"_score":1728916080000},{"rawMessageCount":0,"_score":1728916140000},{"rawSentimentSum":0,"totalSentiment":0,"totalMessageCount":1,"rawMessageCount":1,"_score":1728916200000},{"rawSentimentSum":0.8,"totalSentiment":0.4,"totalMessageCount":2,"rawMessageCount":1,"_score":1728916260000},{"rawMessageCount":0,"_score":1728916320000},{"rawSentimentSum":0.7,"totalSentiment":0.35,"totalMessageCount":2,"rawMessageCount":2,"_score":1728916380000},{"rawMessageCount":0,"_score":1728916440000},{"rawMessageCount":0,"_score":1728916500000},{"rawMessageCount":0,"_score":1728916560000},{"rawMessageCount":0,"_score":1728916620000},{"rawMessageCount":0,"_score":1728916680000},{"rawMessageCount":0,"_score":1728916740000},{"rawMessageCount":0,"_score":1728916800000},{"rawMessageCount":0,"_score":1728916860000}], 
      messages: {"1728842580000":[{"suid":"968_1fd7f10b754859a306399835d0b794d7e06a4bf08857411a008dcbc3d08f282e_2209212","message":"somebody..?","sender":{"firstName":"Shaked","lastName":"Lavian"},"mid":"1728842639179-0"}],"1728843960000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"is this working for everyone?","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728843996491-0"}],"1728844080000":[{"suid":"968_ido.achrak@kaltura.com_2209212","message":"yes!!","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728844092654-0"},{"suid":"968_yair.neumann@kaltura.com_2209212","message":"yofi","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728844105135-0"},{"suid":"968_yair.neumann@kaltura.com_2209212","message":"how are you?","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728844109657-0"},{"suid":"968_ido.achrak@kaltura.com_2209212","message":"i was answering danny, he wasnt looking at the chat...","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728844123090-0"},{"suid":"968_ido.achrak@kaltura.com_2209212","message":"anyway, all looking good","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728844131227-0"}],"1728845940000":[{"suid":"968_ae5b21fd8cec0ac648d08ba58269afcf2c96277e830bf8f99ae1a0190c336239_2209212","message":"https://kaltura-my.sharepoint.com/:p:/r/personal/danny_shapiro_kaltura_com/_layouts/15/Doc.aspx?sourcedoc=%7BD6608726-BAE7-4A91-919B-46DD1E8EDA94%7D&file=Product%20Demo%20Q3%202024.pptx&wdLOR=c936DD5BB-0658-49DF-9CA9-3EF5C9496D6F&action=edit&mobileredirect=true","sender":{"firstName":"Rona","lastName":"Kenig"},"mid":"1728845960132-0"}],"1728912420000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"Hey everyone!","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728912434508-0"},{"suid":"968_5fb255823c476c2216c66c50cdde48b25d5ffb1cea8537494bf253a40f441d30_2209212","message":"Hey Hey Yair","sender":{"firstName":"Arik","lastName":"Perera"},"mid":"1728912476964-0"}],"1728912480000":[{"suid":"968_71eb03ceaad50f91234519632ac3d2148616b504198bbdadde937e6f9c1eb56b_2209212","message":"Good morning!","sender":{"firstName":"Amanda","lastName":"DeGrave"},"mid":"1728912510011-0"}],"1728912540000":[{"suid":"968_c721c1edf01a28efd6d6e84b947a7da6175df682d71f661d92a520a77a2e131f_2209212","message":"Hey everybody!","sender":{"firstName":"Ron","lastName":"Raz"},"mid":"1728912540929-0"}],"1728912600000":[{"suid":"968_b864adb97ee20baab9277441da860127ce2a73adb7624a40906798096e824dae_2209212","message":"Hi All! 👋","sender":{"firstName":"Ben","lastName":"Emery"},"mid":"1728912613621-0"},{"suid":"968_b07ece0bc2f4510c7ac7057479b2080bfa3159a0be95a2b346c45d90c0e3865e_2209212","message":"Good morning!","sender":{"firstName":"Corey","lastName":"Peterson"},"mid":"1728912629959-0"},{"suid":"968_a83a5f66a5509a864cfe508de6e83f9167f0a855a9cc78a8227bbe91e76951e5_2209212","message":"Good morning/afternoon everyone","sender":{"firstName":"John","lastName":"Couperthwaite"},"mid":"1728912633575-0"},{"suid":"968_9daf6d7d76fed7e2d41daed9f1eb0beba156e1d2b55a936bb7ff3fefddb18ad4_2209212","message":"Good morning, good afternoon, good evening all!","sender":{"firstName":"David","lastName":"Rosenbaum"},"mid":"1728912640225-0"},{"suid":"968_01403a30ad21ddccfed828f7e763a7190feda3105fb132503eff92eedc04e6e5_2209212","message":"hello","sender":{"firstName":"Brenda","lastName":"Van Der Burgt"},"mid":"1728912658354-0"},{"suid":"968_hillel.cohen+team@kaltura.com_2209212","message":"hello! 👋","sender":{"firstName":"Hillel","lastName":"Cohen"},"mid":"1728912659875-0"}],"1728912660000":[{"suid":"968_0ff625f991ffd4be81039b35c277fa4980df544f45bb563dc5e30de4bd54ad61_2209212","message":"Hello everyone! ","sender":{"firstName":"Ionut","lastName":"Nastase"},"mid":"1728912669780-0"},{"suid":"968_7a4e90bcd058a6bf2a0d9d880f87189f960875d6e1bb4fd6d354180f9ad26069_2209212","message":"Howdy","sender":{"firstName":"James","lastName":"Vlisides"},"mid":"1728912682657-0"},{"suid":"968_4f82694e83907babe18106a6accc607f34dc957c176019f6cb4e6966192d3d22_2209212","message":"Good afternoon, no music?","sender":{"firstName":"Taco","lastName":"Scargo"},"mid":"1728912692688-0"},{"suid":"968_2787aea177ed1d98c822af9cec3b30cec8f09592e3693fdf708fc40cef6eea39_2209212","message":"hello All!","sender":{"firstName":"Ryan","lastName":"Watt"},"mid":"1728912695144-0"},{"suid":"968_7a4e90bcd058a6bf2a0d9d880f87189f960875d6e1bb4fd6d354180f9ad26069_2209212","message":"Kenny G had a holiday today","sender":{"firstName":"James","lastName":"Vlisides"},"mid":"1728912702762-0"}],"1728912720000":[{"suid":"968_7e1e1ea57a2aecff14e4b8775fde44c1e9305f373fbe7e129d4fd9cbf5e8052e_2209212","message":"Hello Hello","sender":{"firstName":"Salah","lastName":"Majadly"},"mid":"1728912737618-0"},{"suid":"968_7e325591e9f8c3ca6c47563abf84443c3f8962a0ecb3ffc447620a1fb330fca2_2209212","message":"Hello all!","sender":{"firstName":"Stacy","lastName":"McHugh"},"mid":"1728912749953-0"},{"suid":"968_946db0775cc9e626098788c3d9c4257680bb14ae138369ea738926192f28db5e_2209212","message":"Morning/Afternoon!","sender":{"firstName":"Ofer","lastName":"Luft"},"mid":"1728912753772-0"}],"1728912780000":[{"suid":"968_6c7fc2ae72dd33c4199f96c2f9e96492687039294dbdfcafe7023633a6bf148d_2209212","message":"hello","sender":{"firstName":"Tahmid","lastName":"Hassan"},"mid":"1728912818921-0"},{"suid":"968_9c4c83c4f3d0ebe7769034718a43fc496aa20faddf9964566a978ae0dfa2e763_2209212","message":"Hello Everyone!","sender":{"firstName":"Roxy","lastName":"Hennessy"},"mid":"1728912838663-0"}],"1728912840000":[{"suid":"968_c4873ddd1d6876ef8a7414e8d36229b44de544613a8f5aeffcb4182d72e44cb3_2209212","message":"Hello from San Francisco! ","sender":{"firstName":"Laura","lastName":"Wirth"},"mid":"1728912885423-0"}],"1728913020000":[{"suid":"968_tom.gabay@kaltura.com_2209212","message":"Wow the participant list is very cool","sender":{"firstName":"Tom","lastName":"Gabay"},"mid":"1728913043715-0"},{"suid":"968_7db4047286763551216cc85c4f7ea239a45e90c38e21eb4614a077e198349b7b_2209212","message":"hello Kalturians. looking good","sender":{"firstName":"James","lastName":"Wen"},"mid":"1728913051705-0"},{"suid":"968_e6e76c0835bcaa425f0c091a50d5bd155724a30ccf280bf9a527955f1d121ce1_2209212","message":"hello to All","sender":{"firstName":"Ilanit","lastName":"Schreiber"},"mid":"1728913064419-0"},{"suid":"968_314553bdc1a5ad174de7e34ecd5f843e43c17455a14e31faea01789c76dd103d_2209212","message":"Heya Danny and team!","sender":{"firstName":"Nohar","lastName":"Zmora"},"mid":"1728913076176-0"}],"1728913080000":[{"suid":"968_1a60642d70f7e6ab15badd5d3b024ef40a2d3b9e4b2dd40b1aa71d68d6494f62_2209212","message":"How do we enable that for customers? 😊","sender":{"firstName":"Ofir","lastName":"Partok"},"mid":"1728913126283-0"}],"1728913140000":[{"suid":"968_ido.achrak@kaltura.com_2209212","message":"Hi all, \nThe product team are all in the room here, looking to answer to any questions you might have. \n🐛🦋💖⭐😎","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728913160842-0"}],"1728913200000":[{"suid":"968_0e1d5a8b19f639f91e4793e2749240743992767dcc1d3b55c9034c2e88bdd0b2_2209212","message":"This is beta version and we are collecting feedback and validating stability. Soon will be in GA","sender":{"firstName":"Gal","lastName":"Skublevitz"},"mid":"1728913219775-0"}],"1728913260000":[{"suid":"968_1a60642d70f7e6ab15badd5d3b024ef40a2d3b9e4b2dd40b1aa71d68d6494f62_2209212","message":"Thanks Gal! Is this going to be available only for KME (DIY) or live/simulive too?","sender":{"firstName":"Ofir","lastName":"Partok"},"mid":"1728913311922-0"}],"1728913320000":[{"suid":"968_e6e76c0835bcaa425f0c091a50d5bd155724a30ccf280bf9a527955f1d121ce1_2209212","message":"Nice!","sender":{"firstName":"Ilanit","lastName":"Schreiber"},"mid":"1728913336831-0"},{"suid":"968_7e325591e9f8c3ca6c47563abf84443c3f8962a0ecb3ffc447620a1fb330fca2_2209212","message":"Everything needs to be just right! ","sender":{"firstName":"Stacy","lastName":"McHugh"},"mid":"1728913356523-0"}],"1728913380000":[{"suid":"968_0e1d5a8b19f639f91e4793e2749240743992767dcc1d3b55c9034c2e88bdd0b2_2209212","message":"For all Room modes. Live/simulive are not yet in scope","sender":{"firstName":"Gal","lastName":"Skublevitz"},"mid":"1728913391709-0"}],"1728913620000":[{"suid":"968_bc3c2dcbd23351a3d22831c645b40362d9d65ec2960640845ea5769ca7b20620_2209212","message":"Cool","sender":{"firstName":"Moshe","lastName":"Maor"},"mid":"1728913679775-0"}],"1728913800000":[{"suid":"968_c4873ddd1d6876ef8a7414e8d36229b44de544613a8f5aeffcb4182d72e44cb3_2209212","message":"what if a customer has the older version of TEAMs - are we automatically updating them? ","sender":{"firstName":"Laura","lastName":"Wirth"},"mid":"1728913834115-0"}],"1728913920000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"no, not automatically, this would require some work configure","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728913922255-0"}],"1728913980000":[{"suid":"968_c4873ddd1d6876ef8a7414e8d36229b44de544613a8f5aeffcb4182d72e44cb3_2209212","message":"Ok, create a Jira for core?","sender":{"firstName":"Laura","lastName":"Wirth"},"mid":"1728914035773-0"}],"1728914040000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"for PS","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728914044086-0"},{"suid":"968_3c6eb27ee8c6cafbd79c2bb7d4d6ea4f1552e0b6ee669fee3fbde1f85724ebb3_2209212","message":"Love the updated format!","sender":{"firstName":"Julien","lastName":"Petiot"},"mid":"1728914085436-0"}],"1728914100000":[{"suid":"968_4f82694e83907babe18106a6accc607f34dc957c176019f6cb4e6966192d3d22_2209212","message":"Can we have a formal AI policy published on our corp website please before we introduce any AI products?","sender":{"firstName":"Taco","lastName":"Scargo"},"mid":"1728914156873-0"}],"1728914160000":[{"suid":"968_4f82694e83907babe18106a6accc607f34dc957c176019f6cb4e6966192d3d22_2209212","message":"And: when will this be available on EU clouds?","sender":{"firstName":"Taco","lastName":"Scargo"},"mid":"1728914172272-0"}],"1728914220000":[{"suid":"968_danny.shapiro@kaltura.com_2209212","message":"It is in the works with legal and additional teams. We surely understand the need","sender":{"firstName":"Danny","lastName":"Shapiro"},"mid":"1728914267663-0"}],"1728914340000":[{"suid":"968_4f82694e83907babe18106a6accc607f34dc957c176019f6cb4e6966192d3d22_2209212","message":"Any ETA?","sender":{"firstName":"Taco","lastName":"Scargo"},"mid":"1728914381879-0"},{"suid":"968_40d5074ffe51ccec665475b464a515d06476b7dc8d6f5803d9d514636b31be6c_2209212","message":"as simple as the scrubber is on these clips, it is really useful. Nice!","sender":{"firstName":"Matt","lastName":"Soldo"},"mid":"1728914387794-0"}],"1728914400000":[{"suid":"968_3c6eb27ee8c6cafbd79c2bb7d4d6ea4f1552e0b6ee669fee3fbde1f85724ebb3_2209212","message":"is it possible to view the transcript  and the included captions when trimming manually?","sender":{"firstName":"Julien","lastName":"Petiot"},"mid":"1728914415327-0"},{"suid":"968_yair.neumann@kaltura.com_2209212","message":"Regarding the availabiiity in the Regional Clouds, let's take this with the Enablement team in order to understand the potential revenue there.","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728914431746-0"}],"1728914460000":[{"suid":"968_ae53510729904701dd4721223c07046f1f986a6d1ef1d846c7a2f33f5a0156f5_2209212","message":"Could you please explain what the instruction box will be used for?  (e.g what kind of instructions)","sender":{"firstName":"Lucile","lastName":"Sajous"},"mid":"1728914476731-0"},{"suid":"968_a83a5f66a5509a864cfe508de6e83f9167f0a855a9cc78a8227bbe91e76951e5_2209212","message":"Same demand as elsewhere.","sender":{"firstName":"John","lastName":"Couperthwaite"},"mid":"1728914518315-0"}],"1728914520000":[{"suid":"968_4f82694e83907babe18106a6accc607f34dc957c176019f6cb4e6966192d3d22_2209212","message":"The promise of the regional SaaS clouds was that they would exactly match the US SaaS. But we will use US SaaS to demo and create demand.","sender":{"firstName":"Taco","lastName":"Scargo"},"mid":"1728914536095-0"},{"suid":"968_7b232fe18b5bfd5f9e9713f79ef8d12012323764e7e6afa583e7c33101ff4c6f_2209212","message":"The customers will expect this to be available as it is with normal SaaS - when we were doing the regional cloud upgrade last year, one of the main selling point was that new features will be rolled out at the same time as our standard cloud. This will be an escalation from many of the regional cloud customers if we cannot do this","sender":{"firstName":"Tiia","lastName":"Hamalainen"},"mid":"1728914555026-0"}],"1728914580000":[{"suid":"968_a1963e05afb68b2fa7cd874f0c7d479a2d222a2e0469c22c1da1edb469eb42b3_2209212","message":"There should be an option to push the video as an ad to a Linkedin/Meta advertising campaign","sender":{"firstName":"Eran","lastName":"Amit"},"mid":"1728914593694-0"}],"1728914640000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"No one said we can not or we won't. I would like to get visibility into what you understand to be the potential revenue from the feature through the FR process","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728914674760-0"}],"1728914700000":[{"suid":"968_3c6eb27ee8c6cafbd79c2bb7d4d6ea4f1552e0b6ee669fee3fbde1f85724ebb3_2209212","message":"are the scheduled emails sent from the no-reply@kaltura.com email address?","sender":{"firstName":"Julien","lastName":"Petiot"},"mid":"1728914704760-0"}],"1728914820000":[{"suid":"968_a83a5f66a5509a864cfe508de6e83f9167f0a855a9cc78a8227bbe91e76951e5_2209212","message":"Where are the open question responses stored?","sender":{"firstName":"John","lastName":"Couperthwaite"},"mid":"1728914862776-0"}],"1728914880000":[{"suid":"968_c5b281144cd035014c8de2a1f88a5cf1ff682a0468e31acee88fbfee2fb54952_2209212","message":"same as any custom email, based on a customer's custom domain or using our default no-reply@kaltura.events","sender":{"firstName":"Ella","lastName":"Bloch"},"mid":"1728914900112-0"},{"suid":"968_b2ca8543ab7a207bad788fbc29b168f8659f25c47113eae5009b8d6cfbe7dd59_2209212","message":"Will these datapoints also be added to other connectors like SF/Hubspot/Eloqua?","sender":{"firstName":"Ari","lastName":"Sprung"},"mid":"1728914908198-0"},{"suid":"968_1fd7f10b754859a306399835d0b794d7e06a4bf08857411a008dcbc3d08f282e_2209212","message":"not in this release","sender":{"firstName":"Shaked","lastName":"Lavian"},"mid":"1728914934163-0"}],"1728914940000":[{"suid":"968_1fd7f10b754859a306399835d0b794d7e06a4bf08857411a008dcbc3d08f282e_2209212","message":"will be available in the next steps","sender":{"firstName":"Shaked","lastName":"Lavian"},"mid":"1728914968878-0"}],"1728915000000":[{"suid":"968_danny.shapiro@kaltura.com_2209212","message":"Kudos Hazim and the T3 team! You rock!","sender":{"firstName":"Danny","lastName":"Shapiro"},"mid":"1728915005849-0"},{"suid":"968_c5b281144cd035014c8de2a1f88a5cf1ff682a0468e31acee88fbfee2fb54952_2209212","message":"Something you want to clips to focus on, for example Q&A.","sender":{"firstName":"Ella","lastName":"Bloch"},"mid":"1728915014051-0"},{"suid":"968_01403a30ad21ddccfed828f7e763a7190feda3105fb132503eff92eedc04e6e5_2209212","message":"Kudos for accessibility! ","sender":{"firstName":"Brenda","lastName":"Van Der Burgt"},"mid":"1728915055406-0"}],"1728915420000":[{"suid":"968_7a4e90bcd058a6bf2a0d9d880f87189f960875d6e1bb4fd6d354180f9ad26069_2209212","message":"What was the KAC setting to enable that again?","sender":{"firstName":"James","lastName":"Vlisides"},"mid":"1728915432455-0"},{"suid":"968_c721c1edf01a28efd6d6e84b947a7da6175df682d71f661d92a520a77a2e131f_2209212","message":"this is very useful! however, I think that most customers will need to go through a lengthy InfoSec approval before installing the tool","sender":{"firstName":"Ron","lastName":"Raz"},"mid":"1728915436093-0"}],"1728915480000":[{"suid":"968_6ee9dee6e5f645affd50bc7e86cffff8466b0f722f461c24c39e8b2536637c51_2209212","message":"In the Studio","sender":{"firstName":"Louise","lastName":"Szmoisz"},"mid":"1728915481822-0"}],"1728915720000":[{"suid":"968_35038772cd8e81d4358e47489807171249f318375d5cc00ba6c3753968a649b7_2209212","message":"Guess we need a volume leveling feature 😉","sender":{"firstName":"Thomas","lastName":"Ellis"},"mid":"1728915765511-0"}],"1728915780000":[{"suid":"968_ido.achrak@kaltura.com_2209212","message":"\"Enable player calls redirection from V2 to V7\"\nnot out in production yet. will be soon","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728915805906-0"}],"1728915840000":[{"suid":"968_7a4e90bcd058a6bf2a0d9d880f87189f960875d6e1bb4fd6d354180f9ad26069_2209212","message":"Thank you!","sender":{"firstName":"James","lastName":"Vlisides"},"mid":"1728915851279-0"}],"1728916020000":[{"suid":"968_3c6eb27ee8c6cafbd79c2bb7d4d6ea4f1552e0b6ee669fee3fbde1f85724ebb3_2209212","message":"it would be nice to have a way for the in-person speaker names show up for virtual attendees in a hybrid event such as this","sender":{"firstName":"Julien","lastName":"Petiot"},"mid":"1728916028328-0"},{"suid":"968_ido.achrak@kaltura.com_2209212","message":"cool FR","sender":{"firstName":"Ido","lastName":"Achrak"},"mid":"1728916055833-0"}],"1728916200000":[{"suid":"968_e00f1f84cf6424cba59ccaaca488dfa2cc4d0db706f97296fd7901f96ccc506f_2209212","message":"EU Clouds represent some of our largest customers in EMEA.  You want us to open a business case for offering them AI tools?!","sender":{"firstName":"Zoe","lastName":"Fiddes"},"mid":"1728916237862-0"}],"1728916260000":[{"suid":"968_c5b281144cd035014c8de2a1f88a5cf1ff682a0468e31acee88fbfee2fb54952_2209212","message":"Go Renan!","sender":{"firstName":"Ella","lastName":"Bloch"},"mid":"1728916269732-0"}],"1728916380000":[{"suid":"968_yair.neumann@kaltura.com_2209212","message":"Clarification: IRP and FRP are clouds that are INDEED aligned with NVP SaaS under one cloud. With that said, there are some minor additional minor tasks to make the Content Lab available. You are good to continue with offering our clients the Content Lab for those clients","sender":{"firstName":"Yair","lastName":"Neumann"},"mid":"1728916384850-0"},{"suid":"968_9daf6d7d76fed7e2d41daed9f1eb0beba156e1d2b55a936bb7ff3fefddb18ad4_2209212","message":"When will Automation Manager be released as GA?","sender":{"firstName":"David","lastName":"Rosenbaum"},"mid":"1728916414886-0"}]}, 
      chatKey: 'groups:968:1_uiu5jbcm:all'
    }
    </script>
    <!----------------------------------->
    <div class="ver-container title">
      <div class="item">
        <h1>Chat Sentiment</h1>
      </div>

      <div class="hor-container">
        <div>partner</div>
        <div class="item" id="partnerId"></div>
        <div>context</div>
        <div class="item" id="contextId"></div>
      </div>
    </div>

    <div class="ver-container">
      <div class="item">
        <canvas id="sentimentChart" style="width: 80vw"></canvas>
      </div>
      <div class="item">
        <canvas id="countChart" style="width: 80vw; max-height: 200px"></canvas>
      </div>
    </div>

    <dialog>
      <div id="intervalTitle" class="dialog-title"></div>
      <div id="messages"></div>
      <div id="intervalTitle-1" class="dialog-title"></div>
      <div id="messages-1"></div>
      <div id="intervalTitle-2" class="dialog-title"></div>
      <div id="messages-2"></div>
      <button type="button" class="pure-button pure-button-primary">
        Close
      </button>
    </dialog>

    <script>
      // Prepare data:
      const sentiments = trimChatEnd(Data.sentiments);
      const time = sentiments.map((d) => d._score);
      const totalSentiment = sentiments.map((d) => d.totalSentiment);
      const rawMessageCount = sentiments.map((d) => d.rawMessageCount);
      const timeAndCount = time.map(
        (val, idx) => `${timeFromDate(val)} [${rawMessageCount[idx]} messages]`
      );
      const currentIntervalRawSentiment = sentiments.map((d) =>
        d.rawSentimentSum !== undefined
          ? round(d.rawSentimentSum / d.rawMessageCount)
          : undefined
      );

      // Set page sub title:
      document.getElementById("partnerId").innerText =
        Data.chatKey.split(":")[1];
      document.getElementById("contextId").innerText =
        Data.chatKey.split(":")[2];

      // Build charts:
      buildSentimentChart({
        timeAndCount,
        currentIntervalRawSentiment,
        totalSentiment,
        messages: Data.messages,
      });
      buildCountChart({ timeAndCount, rawMessageCount });

      // Register dialog button:
      const dialog = document.querySelector("dialog");
      const closeButton = document.querySelector("dialog button");
      let dialogMessages = document.getElementById("messages");
      let dialogMessages1 = document.getElementById("messages-1");
      let dialogMessages2 = document.getElementById("messages-2");
      let intervalTitle = document.getElementById("intervalTitle");
      let intervalTitle1 = document.getElementById("intervalTitle-1");
      let intervalTitle2 = document.getElementById("intervalTitle-2");
      closeButton.addEventListener("click", () => dialog.close());

      function buildSentimentChart({
        timeAndCount,
        currentIntervalRawSentiment,
        totalSentiment,
        messages,
      }) {
        const onClick = (e) => {
          const activePoints = sentimentChart.getElementsAtEventForMode(
            e,
            "point",
            sentimentChart.options
          );
          if (!activePoints.length) return;
          cleanDialog();
          populateDialog(activePoints[0].index, messages);
          dialog.showModal();
          dialog.scrollTo(0, 0);
        };

        const sentimentChart = new Chart("sentimentChart", {
          type: "scatter",
          data: {
            labels: timeAndCount,
            datasets: [
              {
                label: "Raw Sentiment",
                data: currentIntervalRawSentiment.map((v, idx) => ({
                  x: time[idx],
                  y: v,
                })),
                pointRadius: 4,
                pointBackgroundColor: "green",
                borderColor: "green",
              },
              {
                label: "Normalized Sentiment",
                data: totalSentiment.map((v, idx) => ({
                  x: time[idx],
                  y: v,
                })),
                pointRadius: 8,
                pointBackgroundColor: "orange",
                borderColor: "orange",
              },
            ],
          },
          options: {
            scales: {
              x: {
                ticks: {
                  callback: (value, index, ticks) =>
                    timeFromDate(ticks[index].value),
                },
              },
            },
            onClick,
          },
        });
        return sentimentChart;
      }

      function cleanDialog() {
        dialogMessages.innerHTML =
          dialogMessages1.innerHTML =
          dialogMessages2.innerHTML =
            "";
        intervalTitle.innerHTML =
          intervalTitle1.innerHTML =
          intervalTitle2.innerHTML =
            "";
      }

      function populateDialog(idx0, messages) {
        // Interval 0 (current):
        const epoch0 = time[idx0];
        const messages0 = messages[epoch0];
        const msg0 = getIntervalMessageElements(epoch0, messages0);
        const score0 = currentIntervalRawSentiment[idx0];
        // const ns = sentiments[idx0].totalSentiment
        if (msg0) {
          dialogMessages.append(...msg0);
          intervalTitle.innerText = `Current ${timeFromDate(
            epoch0
          )} | Score ${score0} | ${messages0.length} message${
            messages.length > 1 ? "s" : ""
          }`;
        }

        // Interval -1:
        const idx1 = idx0 - 1;
        const epoch1 = epoch0 - 60_000;
        const messages1 =
          time[idx1] === epoch1 && messages[time[idx1]]
            ? messages[time[idx1]]
            : null;
        const msg1 = getIntervalMessageElements(epoch1, messages1);
        const score1 = currentIntervalRawSentiment[idx1];
        if (msg1) {
          dialogMessages1.append(...msg1);
          intervalTitle1.innerText = `Previous(1) ${timeFromDate(
            epoch1
          )}| Score ${score1} | ${messages1.length} message${
            messages1.length > 1 ? "s" : ""
          }`;
        }

        // Interval -2:
        const epoch2 = epoch0 - 120_000;
        const idx2 = idx0 - 2;
        const messages2 =
          time[idx2] === epoch2 && messages1 && messages[time[idx2]]
            ? messages[time[idx2]]
            : null;
        const msg2 = getIntervalMessageElements(epoch2, messages2);
        const score2 = currentIntervalRawSentiment[idx2];
        if (msg2) {
          dialogMessages2.append(...msg2);
          intervalTitle2.innerText = `Previous(2) ${timeFromDate(
            epoch2
          )} | Score ${score2} | ${messages2.length} message${
            messages2.length > 1 ? "s" : ""
          }`;
        }
        // Build dialog:
      }

      function round(num) {
        return Math.round((num + Number.EPSILON) * 100) / 100;
      }

      function buildCountChart({ timeAndCount, rawMessageCount }) {
        const countChart = new Chart("countChart", {
          type: "bar",
          labels: timeAndCount,
          data: {
            datasets: [
              {
                label: "Message Count",
                data: rawMessageCount.map((v, idx) => ({
                  x: new Date(time[idx]).toISOString(),
                  y: v,
                })),
              },
            ],
          },
          options: {
            scales: {
              x: {
                ticks: {
                  callback: function (value, index, ticks) {
                    return time[index] ? timeFromDate(time[index]) : "";
                  },
                },
              },
            },
          },
        });
        return countChart;
      }

      function timeFromDate(dateEpoch) {
        return new Date(dateEpoch).toISOString().match("T([^\.]+)\.")[1];
      }

      function trimChatEnd(sentiments) {
        let endIdx = null;
        for (const [i, s] of Object.entries(sentiments)) {
          if (s.totalSentiment === undefined && endIdx === null) {
            endIdx = i;
          }
          if (s.totalSentiment !== undefined && endIdx !== null) {
            endIdx = null;
          }
        }
        if (endIdx !== null) {
          return sentiments.slice(0, endIdx);
        }
        return sentiments;
      }

      function getIntervalMessageElements(intervalEpoch, messages) {
        if (!messages?.length) return;
        const messageElements = messages
          .map((m) => m.message)
          .map((msg, idx) => {
            const p = document.createElement("p");
            p.innerText = msg;
            return p;
          });
        return messageElements;
      }
    </script>
  </body>
</html>
